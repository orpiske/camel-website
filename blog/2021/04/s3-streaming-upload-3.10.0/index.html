<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../../../favicon-128.png" sizes="128x128"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../../../site.webmanifest"> <title>Camel-AWS-S3 - New Streaming upload feature - Apache Camel</title> <link rel="canonical" href="../../../../blog/2021/04/s3-streaming-upload-3.10.0/"> <link rel="stylesheet" href="../../../../_/css/site-5bbb41c887.css"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../../../../" title="Apache Camel"></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../blog/"> <img alt="Blog" src="../../../../_/img/blog.svg"> Blog </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../docs/"> <img alt="Documentation" src="../../../../_/img/documentation.svg"> Documentation </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../community/"> <img alt="Community" src="../../../../_/img/community.svg"> Community </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../download/"> <img alt="Download" src="../../../../_/img/download.svg"> Download </a> </div> </div> <div class="navbar-fill"></div> <div class="break-row"></div> <div class="navbar-search results-hidden"> <input id="search" class="search" placeholder="Search" autocomplete="off"> <img src="/_/img/cancel.svg" alt="Clear" id="search-cancel"> <div id="search_results"></div> </div> <div class="navbar-tools"> <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos.svg#github"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos.svg#zulip"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <a id="top"></a> <div class="body"> <main role="main blog"> <article class="blog doc"> <header> <a class="category" href="../../../../categories/Features/">FEATURES</a><a class="category" href="../../../../categories/Camel/">CAMEL</a> <h1>Camel-AWS-S3 - New Streaming upload feature</h1> </header> <div class="post"> <aside> <div class="summary">AWS S3 Streaming upload</div> Posted on <time itemprop="published" datetime="2021-04-20" title="Tuesday, April 20, 2021">April 20, 2021</time>, by <figure> <img src="https://avatars.githubusercontent.com/u/5106647?v=4" alt="Andrea Cosentino"> <figcaption rel="author">Andrea Cosentino</figcaption> </figure> <p> <a class="arrow prev" href="../../../../blog/2021/04/camel-quarkus-release-1.8.1/" title="Previous post: Camel Quarkus 1.8.1 Released">&#10094;</a> <a class="arrow next" href="../../../../blog/2021/04/camel-k-140-Whatsnew/" title="Next post: Apache Camel K 1.4.0 What&#39;s New">&#10095;</a> </p> </aside> <div class="post-content"> <img class="featured" alt="Blog post featured image" src="../../../../blog/2021/04/s3-streaming-upload-3.10.0/camel-featured_hub90352a773889fde5cf74e9c68bd9be1_625206_800x0_resize_q95_gaussian.jpeg" width="800" height="533"> <p>In the last weeks I was focused on a particular feature for the Camel AWS S3 component: the streaming upload feature.</p> <p>In this post I&rsquo;m going to summarize what it is an how to use it.</p> <h2 id="streaming-upload">Streaming upload</h2> <p>The AWS S3 component had already a multipart upload feature in his producer operations: the main &ldquo;problem&rdquo; with it, was the need of knowing the size of the upload ahead of time.</p> <p>The streaming upload feature coming in Camel 3.10.0 won&rsquo;t need to know the size before starting the upload.</p> <h3 id="how-it-works">How it works</h3> <p>Obviously this feature has been implemented on the S3 component producer side.</p> <p>The idea is to continuously send data to the producer and batching the messages. On the endpoint you&rsquo;ll have three possible way of stopping the batching: - timeout - buffer size - batch size</p> <p>Buffer size and batch size will work together, this means that the batch will be completed when the batch size is complete or when the set buffer size has been excedeed.</p> <p>With the timeout in the picture the batching will be stopped and the upload completed (also) when the timeout will be reached.</p> <h3 id="s3-files-naming">S3 Files naming</h3> <p>In the streaming upload producer two different naming strategy are provided: - progressive - random</p> <p>The progressive one will add a progressive suffix to the uploaded part, while the random one will add a random id as keyname suffix.</p> <p>If the S3 key name you&rsquo;ll specify on your endpoint will be &ldquo;file_upload_part.txt&rdquo;, during the upload you can expect a list like:</p> <ul> <li>file_upload_part.txt</li> <li>file_upload_part-1.txt</li> <li>file_upload_part-2.txt</li> </ul> <p>and so on.</p> <p>The progressive naming strategy will make you ask how does it work when I stop and restart the route?</p> <h3 id="restarting-strategies">Restarting Strategies</h3> <p>The restarting strategies provided in the S3 Streaming upload producer are:</p> <ul> <li>lastPart</li> <li>override</li> </ul> <p>the lastPart strategy will make sense only in combination with the progressive naming strategy, obviously.</p> <p>At the time of restarting the route, the producer will check for the S3 keyname prefix in the bucket specified and get the last index uploaded.</p> <p>The index will be used to start again from the same point.</p> <h3 id="sample">Sample</h3> <p>This feature is very nice to see in action.</p> <p>In the <a href="https://github.com/apache/camel-examples/tree/master/examples/aws/main-endpointdsl-kafka-aws2-s3-restarting-policy" rel="nofollow noreferrer">camel-examples repository</a> I added an example of the feature with Kafka as consumer.</p> <p>The example will poll one kafka topic s3.topic.1 and upload batch of 25 messages (or 1 Mb batch) as single file into an s3 bucket (mycamel-1).</p> <p>In the <a href="https://github.com/apache/camel-examples/tree/master/examples/aws/main-endpointdsl-kafka-aws2-s3-restarting-policy#how-to-run" rel="nofollow noreferrer">how to run section</a> of the README it is explained well how to ingest data to your Kafka broker.</p> <h3 id="conclusion">Conclusion</h3> <p>The streaming upload feature will be useful in situation where the user don&rsquo;t know the amount of data he wants to upload to S3, but also when he just wants to ingest data continuously without having to care about the size.</p> <p>There is probably more work to do, but this can be a feature to introduce even in other storage components we have in Apache Camel.</p> <div class="related"> <h3 id="related"><a class="anchor" href="#related"></a>Related posts</h3> <article class="blog doc"> <header> <a href="../../../../blog/2020/10/camel-aws2-eventbridge-intro/"><h1>Introducing Camel-AWS2-Eventbridge component</h1></a> <time itemprop="published" datetime="2020-10-17" title="Saturday, October 17, 2020">October 17, 2020</time>, by <span rel="author">Andrea Cosentino</span> </header> <p>In Camel 3.6.0 we will introduce the camel-aws2-eventbridge among others new cool components. The aim of this blog post is showing what you can do with the Eventbridge AWS Service and the related camel component. What is AWS Eventbridge? The definition from the AWS official website is the following: Amazon EventBridge is a serverless event bus that makes it easy to connect applications together using data from your own applications, integrated Software-as-a-Service (SaaS) applications, and AWS services.</p> <p><a class="continue" href="../../../../blog/2020/10/camel-aws2-eventbridge-intro/">Continue reading &#10095;</a></p> <p> <a class="category" href="../../../../categories/Camel/">CAMEL</a> </p> </article> </div> </div> </div> </article> </main> </div> <div class="footer-tools"> <a title="Improve this document, receive free virtual hugs &hearts;" href="https://github.com/apache/camel-website/edit/main/content/blog/2021/04/s3-streaming-upload-3.10.0/index.md">Edit this Page</a> <a href="#top" title="Reach the top of the page">Back to top</a> </div> <footer> <div class="footer"> <figure class="logo"> <img class="logo" src="../../../../_/img/logo-d.svg" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <input id="footer-toggle-overview" type="checkbox" title="Show/Hide Overview section"> <dl> <dt><label for="footer-toggle-overview">Overview</label><label for="footer-toggle-overview">&#65291;</label></dt> <dd><a href="../../../../blog/">Blog</a></dd> <dd><a href="../../../../docs/">Documentation</a></dd> <dd><a href="../../../../community/support/">Community</a></dd> <dd><a href="../../../../blog/">Download</a></dd> </dl> <input id="footer-toggle-documentation" type="checkbox" title="Show/Hide Documentation section"> <dl> <dt><label for="footer-toggle-documentation">Documentation</label><label for="footer-toggle-documentation">&#65291;</label></dt> <dd><a href="../../../../manual/latest/">User Manual</a></dd> <dd><a href="../../../../components/latest/index.html">Components</a></dd> <dd><a href="../../../../camel-k/latest/">Camel-K</a></dd> <dd><a href="../../../../camel-kafka-connector/latest/">Camel Kafka Connector</a></dd> <dd><a href="../../../../camel-quarkus/latest/">Camel Quarkus</a></dd> <dd><a href="../../../../camel-spring-boot/latest/">Camel Spring Boot</a></dd> <dd><a href="../../../../camel-karaf/latest/">Camel Karaf</a></dd> <dd><a href="../../../../manual/latest/faq/index.html">FAQ</a></dd> </dl> <input id="footer-toggle-community" type="checkbox" title="Show/Hide Community section"> <dl> <dt><label for="footer-toggle-community">Community</label><label for="footer-toggle-community">&#65291;</label></dt> <dd><a href="../../../../community/support/">Support</a></dd> <dd><a href="../../../../manual/latest/contributing.html">Contributing</a></dd> <dd><a href="../../../../manual/latest/mailing-lists.html">Mailing Lists</a></dd> <dd><a href="../../../../community/user-stories/">User stories</a></dd> <dd><a href="../../../../community/articles/">Articles</a></dd> <dd><a href="../../../../community/books/">Books</a></dd> <dd><a href="../../../../community/team/">Team</a></dd> </dl> <input id="footer-toggle-about" type="checkbox" title="Show/Hide Acknowledgements section"> <dl> <dt><label for="footer-toggle-about">About</label><label for="footer-toggle-about">&#65291;</label></dt> <dd><a href="../../../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p class="remark"> &copy; 2004-2021 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> <div class="resources"> <div class="context"> <a href="../../../../privacy-policy/">Privacy Policy</a> </div> <div class="context"> <a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a> </div> <div class="context"> <a href="../../../../sitemap/">Sitemap</a> </div> </div> <div class="footer-icons"> <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos.svg#github"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos.svg#zulip"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos.svg#twitter"/></svg></a> </div> </div> </footer> <script src="../../../../_/js/vendor/algoliasearch-8fe81df376.js"></script> <script src="../../../../_/js/site-0d18f68ee9.js"></script> <script async src="../../../../_/js/vendor/highlight-a988c6fdd9.js"></script> <script async src="../../../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Organization", "name": "Apache Camel", "url": "https:\/\/camel.apache.org\/" , "sameAs": ["https://twitter.com/ApacheCamel"] , "logo": "https:\/\/camel.apache.org\/_\/img\/logo-d.svg" , "description": "Apache Camel â„¢ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL." } </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BreadcrumbList", "itemListElement": [{ "@type": "ListItem", "position": 1 , "item": { "@id": "https://camel.apache.org/", "name": "Apache Camel" } },{ "@type": "ListItem", "position": 2 , "item": { "@id": "https://camel.apache.org/blog/", "name": "blog" } },{ "@type": "ListItem", "position": 3 , "item": { "@id": "https://camel.apache.org/blog/2021/", "name": "2021" } },{ "@type": "ListItem", "position": 4 , "item": { "@id": "https://camel.apache.org/blog/2021/04/", "name": "04" } },{ "@type": "ListItem", "position": 5 , "item": { "@id": "https://camel.apache.org/blog/2021/04/s3-streaming-upload-3.10.0/", "name": "s3-streaming-upload-3.10.0" } }] } </script> </body> </html> 